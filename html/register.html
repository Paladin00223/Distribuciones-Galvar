<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrarse a Distribuciones Galvar</title>
    <link rel="stylesheet" href="../css/register.css">
</head>

<body>
    <nav>
        <h1>¡Tu Lugar Está Esperando Por Ti!</h1>
    </nav>

    <header>
        <h2>Empieza a ser cliente, acumula puntos y empieza el camino hacia tu libertad financiera</h2>
    </header>

    <main>
        <form id="registerForm" class="register-form">
            <div class="form-group">
                <label for="nombre">Nombre completo</label>
                <input type="text" id="nombre" name="nombre" required>
            </div>
            <div class="form-group">
                <label for="email">Correo electrónico</label>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="form-group">
                <label for="password">Contraseña</label>
                <input type="password" id="password" name="password" required>
            </div>
            <div class="form-group">
                <label for="confirmPassword">Confirmar contraseña</label>
                <input type="password" id="confirmPassword" name="confirmPassword" required>
            </div>
            <div class="form-group">
                <label for="referido">Código de referido (opcional)</label>
                <input type="text" id="referido" name="referido">
            </div>
            <button type="submit" class="btn-register">Registrarse</button>
        </form>

        <style>
            .file-upload {
                position: relative;
                margin-bottom: 1rem;
            }

            .file-upload input[type="file"] {
                width: 100%;
                padding: 0.5rem;
                border: 1px solid #ddd;
                border-radius: 4px;
                background-color: white;
            }

            .file-preview {
                margin-top: 0.5rem;
            }

            .file-preview img {
                border-radius: 4px;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            }
        </style>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const registerForm = document.getElementById('registerForm');

                registerForm.addEventListener('submit', function (e) {
                    e.preventDefault();

                    const nombre = document.getElementById('nombre').value.trim();
                    const email = document.getElementById('email').value.trim();
                    const password = document.getElementById('password').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    const referido = document.getElementById('referido').value.trim();

                    // Validaciones básicas
                    if (!nombre || !email || !password || !confirmPassword) {
                        alert('Por favor complete todos los campos obligatorios');
                        return;
                    }

                    if (password !== confirmPassword) {
                        alert('Las contraseñas no coinciden');
                        return;
                    }

                    if (password.length < 6) {
                        alert('La contraseña debe tener al menos 6 caracteres');
                        return;
                    }

                    // Validar formato de email
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        alert('Por favor ingrese un correo electrónico válido');
                        return;
                    }

                    try {
                        // Obtener usuarios existentes
                        const usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];

                        // Verificar si el email ya está registrado
                        if (usuarios.some(u => u.email === email)) {
                            alert('Este correo electrónico ya está registrado');
                            return;
                        }

                        // Crear nuevo usuario
                        const nuevoUsuario = {
                            nombre,
                            email,
                            password,
                            referido: referido || null,
                            puntos: 0,
                            estado: 'activo',
                            fechaRegistro: new Date().toISOString()
                        };

                        // Agregar usuario a la lista
                        usuarios.push(nuevoUsuario);

                        fetch('http://localhost:5000/usuarios', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                nombre,
                                email,
                                puntos: 0,
                                estado: 'activo'
                            })
                        })
                            .then(response => response.json())
                            .then(data => {
                                if (data.status === 'ok') {
                                    alert('¡Registro exitoso! Será redirigido a la página de inicio de sesión.');
                                    window.location.href = 'login.html';
                                } else {
                                    alert('Hubo un error al registrar el usuario.');
                                }
                            })
                            .catch(error => {
                                console.error('Error en el registro:', error);
                                alert('Hubo un error al registrar el usuario. Por favor intente nuevamente.');
                            });
                    } catch (error) {
                        console.error('Error en el registro:', error);
                        alert('Hubo un error al registrar el usuario. Por favor intente nuevamente.');
                    }
                });
            });
        </script>

        <div class="login-link">
            <p>¿Ya tienes cuenta? <a href="login.html">Inicia sesión aquí</a></p>
        </div>
    </main>

    <footer>

        <button class="contact-button">Contacto: 320 818 6026</button>
        <br>
        &copy; 26 mayo 2025 - Distribuciones Galvar. Todos los derechos reservados

    </footer>
    <script src="../js/register.js"></script>
    <script src="../js/contacto.js"></script>
</body>

</html>